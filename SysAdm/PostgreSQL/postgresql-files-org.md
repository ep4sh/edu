![PostgreSQL](../../img/postgresql.png)

## Низкий уроверь. Организация файлов

### Слои.

 * Основной - данные, существует для всех объектов
 * Инициализации - заготовка пустого основного пустого слоя,  
   используется при сбое только для нежурналир. таблиц
 * FreeSpaceMap - слой, хранящий инфу где фнутри файлов есть свободное пространство для MVCC после VACUUM
 * VisibilyMap - битовая карта со страницами, где версии все версии строк видны во всех снимках
   Используется для оптимизации. Только для таблиц.
 
 ### TOAST
 
#### Версия строки должна помещаться на одну страницу..Что сделать?

 * можно сжать часть аттрибутов
 * вынести в TOAST-таблицу
 * п1 и п2

#### TOAST-таблица:
* Схема pg_toast, pg_toast_temp_N
* длинные аттрибуты разделены на части размером меньше страницы
* читается только при образении к длинному атрибуту
* собственная версионность
* работает прозрачно для приложух



### DEMO

Вернуть путь до файлов с `OID`:
```
SELECT pg_relation_filepath('t');
```

```
SELECT OID from pg_database WHERE datname = 'datalowlvl';
SELECT relfilenode from pg_class WHERE relname = 't';
```

# ОЧЕНЬ ПОЛЕЗНАЯ ШТУКА:
Для БД:  
```
oid2name
```

Для табличных пространств:  
```
oid2name -d datalowlvl -s
```

Для таблиц:  
```
oid2name -d datalowlvl -t t
oid2name -d datalowlvl -f 16338
```
